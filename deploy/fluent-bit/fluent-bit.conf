[SERVICE]
    Flush         1
    Log_Level     info
    Daemon        off
    Parsers_File  parsers.conf

# Collect Docker container logs
[INPUT]
    Name              tail
    Path              /var/lib/docker/containers/*/*.log
    Parser            docker
    Tag               docker.*
    Refresh_Interval  5
    Mem_Buf_Limit     50MB
    Skip_Long_Lines   On

# Collect Django application logs
[INPUT]
    Name              tail
    Path              /var/log/django/*.log
    Tag               django.*
    Refresh_Interval  5
    Mem_Buf_Limit     10MB

# Filter - Add hostname
[FILTER]
    Name          record_modifier
    Match         *
    Record        hostname ${HOSTNAME}

# Filter - Parse JSON logs
[FILTER]
    Name          parser
    Match         django.*
    Key_Name      log
    Parser        json
    Reserve_Data  True

# Output to OpenSearch
[OUTPUT]
    Name            opensearch
    Match           *
    Host            opensearch
    Port            9200
    Index           logs
    Type            _doc
    Logstash_Format On
    Logstash_Prefix logs
    Suppress_Type_Name On
    tls             Off
    tls.verify      Off
    Retry_Limit     False

# Output to stdout for debugging
[OUTPUT]
    Name   stdout
    Match  *
    Format json_lines

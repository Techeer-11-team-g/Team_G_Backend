# =============================================================================
# Prometheus Configuration
# 메트릭 수집 설정
#
# GCP VPC 내부 IP 설정:
# - App Server: 10.0.0.4
# - Queue Server: 10.0.0.5
# - Monitoring Server: 10.0.0.6
# - Search Server: 10.0.0.3
# =============================================================================

global:
  scrape_interval: 15s
  evaluation_interval: 15s

alerting:
  alertmanagers:
    - static_configs:
        - targets: ['alertmanager:9093']

rule_files:
  - '/etc/prometheus/alert-rules.yml'

scrape_configs:
  # =========================================================================
  # Monitoring Server 자체 메트릭
  # =========================================================================

  # Prometheus self-monitoring
  - job_name: 'prometheus'
    static_configs:
      - targets: ['localhost:9090']

  # Node Exporter - 호스트 메트릭 (CPU, Memory, Disk, Network)
  - job_name: 'node-exporter'
    static_configs:
      - targets: ['node-exporter:9100']

  # Loki - 로그 시스템 메트릭
  - job_name: 'loki'
    static_configs:
      - targets: ['loki:3100']

  # Jaeger - 분산 트레이싱 메트릭
  - job_name: 'jaeger'
    static_configs:
      - targets: ['jaeger:14269']

  # =========================================================================
  # App Server (Django) - 10.0.0.4
  # =========================================================================
  - job_name: 'django'
    scheme: https
    tls_config:
      insecure_skip_verify: true
    static_configs:
      - targets: ['10.0.0.4:443']
    metrics_path: /metrics

  # Promtail (App Server) - 로그 수집 에이전트 메트릭
  - job_name: 'promtail-app'
    static_configs:
      - targets: ['10.0.0.4:9080']

  # =========================================================================
  # Queue Server (Redis, RabbitMQ, Flower) - 10.0.0.5
  # =========================================================================
  - job_name: 'redis'
    static_configs:
      - targets: ['10.0.0.5:9121']

  - job_name: 'rabbitmq'
    static_configs:
      - targets: ['10.0.0.5:15692']

  - job_name: 'flower'
    static_configs:
      - targets: ['10.0.0.5:5555']

  # =========================================================================
  # Search Server (OpenSearch) - 10.0.0.3
  # 현재 비활성화 상태 (메트릭 플러그인 미설치)
  # =========================================================================
  # - job_name: 'opensearch'
  #   static_configs:
  #     - targets: ['10.0.0.3:9200']
  #   metrics_path: /_prometheus/metrics
